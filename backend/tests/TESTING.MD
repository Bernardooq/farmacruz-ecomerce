# ğŸ§ª GuÃ­a de Testing - Farmacruz API

## ğŸ“‹ Contenido de Tests

La suite de tests completa cubre:

### âœ… AutenticaciÃ³n (8 tests)

* Registro de usuarios
* Login con diferentes roles
* ValidaciÃ³n de tokens
* Manejo de errores de autenticaciÃ³n

### âœ… CategorÃ­as (9 tests)

* CRUD completo de categorÃ­as
* Permisos seller/admin
* BÃºsqueda de categorÃ­as
* ValidaciÃ³n de duplicados
* ProtecciÃ³n contra eliminaciÃ³n con productos

### âœ… Productos (10 tests)

* CRUD completo de productos
* ActualizaciÃ³n de imÃ¡genes (seller)
* GestiÃ³n de stock
* BÃºsqueda y filtros
* Permisos por rol

### âœ… Carrito (5 tests)

* Agregar productos al carrito
* Actualizar cantidades
* Proceso de checkout
* Limpieza de carrito

### âœ… Pedidos (6 tests)

* CreaciÃ³n de pedidos
* ActualizaciÃ³n de estados
* Filtros por estado
* Permisos por rol

### âœ… AdministraciÃ³n (6 tests)

* Dashboard y estadÃ­sticas
* GestiÃ³n de usuarios
* Permisos administrativos

### âœ… ValidaciÃ³n y Errores (6 tests)

* Manejo de tokens invÃ¡lidos
* ValidaciÃ³n de datos
* Recursos inexistentes
* Casos edge

## ğŸš€ Ejecutar Tests

### OpciÃ³n 1: Scripts automÃ¡ticos

**Linux/Mac:**

```bash
chmod +x run_tests.sh
./run_tests.sh
```

**Windows:**

```bash
run_tests.bat
```

### OpciÃ³n 2: Comando manual

```bash
# Instalar dependencias de test
pip install pytest pytest-cov httpx

# Ejecutar todos los tests
cd backend/farmacruz_api
pytest tests/test_api_complete.py -v

# Con reporte de cobertura
pytest tests/test_api_complete.py -v --cov=. --cov-report=html
```

### OpciÃ³n 3: Tests especÃ­ficos

```bash
# Solo tests de autenticaciÃ³n
pytest tests/test_api_complete.py::TestAuth -v

# Solo tests de productos
pytest tests/test_api_complete.py::TestProducts -v

# Solo tests de categorÃ­as
pytest tests/test_api_complete.py::TestCategories -v

# Un test especÃ­fico
pytest tests/test_api_complete.py::TestAuth::test_login_admin -v
```

## ğŸ“Š Cobertura de CÃ³digo

DespuÃ©s de ejecutar los tests con cobertura, abre el reporte HTML:

```bash
# Se genera automÃ¡ticamente en:
backend/farmacruz_api/htmlcov/index.html

# Abrir en navegador
# Linux/Mac:
open htmlcov/index.html

# Windows:
start htmlcov/index.html
```

## ğŸ¯ EstadÃ­sticas Esperadas

Al ejecutar todos los tests deberÃ­as ver:

```
âœ… Total de tests: ~50
âœ… Tests pasados: 50
âœ… Cobertura esperada: >85%
â±ï¸  Tiempo de ejecuciÃ³n: ~10-15 segundos
```

## ğŸ“ Estructura de Tests

```
tests/
â”œâ”€â”€ test_api_complete.py    # Suite completa
â”œâ”€â”€ test_dbf_individual.py  # Tests de DBF
â””â”€â”€ test_dbf_traductor.py   # Tests de DBF traductor
```

## ğŸ” Debugging Tests

### Ver output detallado:

```bash
pytest tests/test_api_complete.py -v -s
```

### Ver solo tests fallidos:

```bash
pytest tests/test_api_complete.py --lf -v
```

### Parar en el primer error:

```bash
pytest tests/test_api_complete.py -x -v
```

### Ver traceback completo:

```bash
pytest tests/test_api_complete.py -v --tb=long
```

## ğŸ› Troubleshooting

### Error: ModuleNotFoundError

```bash
# AsegÃºrate de estar en el directorio correcto
cd backend/farmacruz_api

# O establece el PYTHONPATH
export PYTHONPATH="${PYTHONPATH}:$(pwd)"  # Linux/Mac
set PYTHONPATH=%PYTHONPATH%;%cd%          # Windows
```

### Error: Database connection

Los tests usan SQLite en memoria, no necesitan PostgreSQL. Si hay error:

```bash
pip install sqlalchemy --upgrade
```

### Error: Token invÃ¡lido

Los tests crean usuarios de prueba automÃ¡ticamente. Si fallan:

```bash
# Limpia y vuelve a ejecutar
pytest tests/test_api_complete.py -v --cache-clear
```

## ğŸ“ˆ CI/CD Integration

Para integrar en GitHub Actions:

```yaml
name: Tests
on: [push, pull_request]

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-python@v2
        with:
          python-version: '3.10'
      - name: Install dependencies
        run: |
          pip install -r requirements.txt
      - name: Run tests
        run: |
          cd backend/farmacruz_api
          pytest tests/test_api_complete.py -v --cov=.
```

## ğŸ¨ Personalizar Tests

### Agregar nuevos tests:

```python
class TestMiNuevaFuncionalidad:
    """Tests de mi nueva funcionalidad"""
  
    def test_mi_caso(self):
        """DescripciÃ³n del test"""
        response = client.get("/api/v1/mi-endpoint")
        assert response.status_code == 200
```

### Usar fixtures:

```python
@pytest.fixture
def mi_fixture():
    # Setup
    yield data
    # Cleanup
```

## ğŸ“ Soporte

Si tienes problemas con los tests:

1. Verifica que todas las dependencias estÃ©n instaladas
2. Revisa que estÃ©s en el directorio correcto
3. Limpia el cache de pytest: `pytest --cache-clear`
4. Ejecuta tests individuales para identificar el problema

---

**Ãšltima actualizaciÃ³n:** Noviembre 2024
**VersiÃ³n:** 1.0.0
